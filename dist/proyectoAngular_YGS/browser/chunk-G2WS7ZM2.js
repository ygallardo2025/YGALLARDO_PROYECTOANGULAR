import{m as p,n as g}from"./chunk-S7ZWUZXC.js";import{T as c,X as l,Y as u,j as o,r as a,ta as m}from"./chunk-6F7WF5WO.js";var h=class t{constructor(e){this.http=e;let r=this.safeGetItem("auth.user");if(r)try{this.currentUserSubject.next(JSON.parse(r))}catch{}}apiUrl="https://68a470c4c123272fb9b2b56f.mockapi.io/users";platformId=u(m);isBrowser=p(this.platformId);storage=this.isBrowser&&typeof window<"u"&&"localStorage"in window?window.localStorage:f();currentUserSubject=new o(null);currentUser$=this.currentUserSubject.asObservable();get currentUser(){return this.currentUserSubject.value}isAuthenticated(){return!!this.currentUserSubject.value?.token}hasRole(e){return this.currentUser?.role===e}login(e,r){return this.http.get(`${this.apiUrl}?email=${encodeURIComponent(e)}&password=${encodeURIComponent(r)}`).pipe(a(n=>{if(!n.length)throw new Error("Credenciales inv\xE1lidas");let i=n[0],s={id:Number(i.id),name:i.name,email:i.email,role:i.role??"user",token:d()};return this.safeSetItem("auth.user",JSON.stringify(s)),this.currentUserSubject.next(s),s}))}logout(){this.safeRemoveItem("auth.user"),this.currentUserSubject.next(null)}safeGetItem(e){try{return this.storage.getItem(e)}catch{return null}}safeSetItem(e,r){try{this.storage.setItem(e,r)}catch{}}safeRemoveItem(e){try{this.storage.removeItem(e)}catch{}}static \u0275fac=function(r){return new(r||t)(l(g))};static \u0275prov=c({token:t,factory:t.\u0275fac,providedIn:"root"})};function f(){let t=new Map;return{getItem:e=>t.has(e)?t.get(e):null,setItem:(e,r)=>{t.set(e,r)},removeItem:e=>{t.delete(e)}}}function d(){try{let t=new Uint8Array(16);return(globalThis.crypto||globalThis.msCrypto).getRandomValues(t),Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}catch{return Math.random().toString(36).slice(2)}}export{h as a};
