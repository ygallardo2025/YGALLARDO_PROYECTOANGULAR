import{a as ie}from"./chunk-5IFMELBI.js";import{a as J,b as K,c as Q,d as W,e as X,f as Y,g as Z,h as ee,i as te,j as re,k as oe}from"./chunk-HYBGBYM6.js";import{a as G}from"./chunk-NGHFI2C2.js";import{a as H,b as I,c as $,d as j,e as q,g as B,h as z,l as L,m as U}from"./chunk-F6YX5B72.js";import{g as R,h}from"./chunk-VBKEXR47.js";import{$ as _,Aa as N,Cb as V,Ea as b,Ja as d,La as x,Va as c,W as T,Wa as n,Xa as i,Ya as C,a as E,aa as g,ab as w,b as k,bb as M,c as O,db as y,eb as u,fb as p,ka as P,mb as D,nb as s,ob as f,pb as A,q as v,va as a}from"./chunk-O2KJT2HM.js";function le(r,t){r&1&&(n(0,"th",8),s(1,"T\xEDtulo"),i())}function me(r,t){if(r&1&&(n(0,"td",9),s(1),i()),r&2){let e=t.$implicit;a(),f(e.title)}}function ce(r,t){r&1&&(n(0,"th",8),s(1,"Descripci\xF3n"),i())}function ue(r,t){if(r&1&&(n(0,"td",9),s(1),i()),r&2){let e=t.$implicit;a(),f(e.description)}}function de(r,t){r&1&&(n(0,"th",8),s(1,"Acciones"),i())}function pe(r,t){if(r&1){let e=y();n(0,"td",9)(1,"button",10),u("click",function(){let l=_(e).$implicit,m=p();return g(m.editarCurso(l))}),s(2,"Editar"),i(),n(3,"button",11),u("click",function(){let l=_(e).$implicit,m=p();return g(m.eliminarCurso(l))}),s(4,"Eliminar"),i()()}}function fe(r,t){r&1&&C(0,"tr",12)}function Ce(r,t){r&1&&C(0,"tr",13)}var S=class r{courses=[];canEdit=!1;eliminar=new x;editar=new x;baseColumns=["title","description"];get displayedColumns(){return this.canEdit?[...this.baseColumns,"actions"]:this.baseColumns}eliminarCurso(t){this.eliminar.emit(t)}editarCurso(t){this.editar.emit(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=b({type:r,selectors:[["app-courses-table"]],inputs:{courses:"courses",canEdit:"canEdit"},outputs:{eliminar:"eliminar",editar:"editar"},decls:12,vars:3,consts:[["mat-table","",1,"mat-elevation-z1",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-cell","","class","text-center",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","actions"],["mat-header-row","","class","table-primary",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"text-center"],["mat-cell","",1,"text-center"],[1,"btn","btn-sm","btn-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"],["mat-header-row","",1,"table-primary"],["mat-row",""]],template:function(e,o){e&1&&(n(0,"table",0),w(1,1),d(2,le,2,0,"th",2)(3,me,2,1,"td",3),M(),w(4,4),d(5,ce,2,0,"th",2)(6,ue,2,1,"td",3),M(),w(7,5),d(8,de,2,0,"th",2)(9,pe,5,0,"td",3),M(),d(10,fe,1,0,"tr",6)(11,Ce,1,0,"tr",7),i()),e&2&&(c("dataSource",o.courses),a(10),c("matHeaderRowDef",o.displayedColumns),a(),c("matRowDefColumns",o.displayedColumns))},dependencies:[h,oe,J,Q,Z,W,K,ee,X,Y,te,re],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0;border-radius:12px;overflow:hidden;background-color:#fff;box-shadow:0 2px 6px #0000000d;font-family:Segoe UI,sans-serif;border:1px solid #eee}th[_ngcontent-%COMP%]{background-color:#f7f7f7;color:#333;font-weight:600;padding:14px;text-align:center;border-bottom:1px solid #e0e0e0}td[_ngcontent-%COMP%]{padding:14px;text-align:center;border-bottom:1px solid #f0f0f0}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}tr[_ngcontent-%COMP%]:hover{background-color:#f9f9f9;transition:background-color .2s ease}button[_ngcontent-%COMP%]{border:none;border-radius:6px;padding:6px 14px;font-weight:500}.btn-primary[_ngcontent-%COMP%]{background-color:#2979ff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#1565c0}.btn-danger[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c62828}"]})};var F=class r{constructor(t){this.fb=t;this.courseForm=this.fb.group({id:[null],title:["",[I.required]],description:["",[I.required]]})}course=null;save=new x;courseForm;ngOnChanges(t){t.course&&this.course&&this.courseForm.reset(this.course)}getErrorMessage(t){let e=this.courseForm.get(t);return!e||!e.errors||!(e.touched||e.dirty)?null:e.errors.required?"Este campo es obligatorio.":null}onSubmit(){if(this.courseForm.markAllAsTouched(),this.courseForm.valid){let t=this.courseForm.value,e=k(E({},t),{id:this.course?.id??t.id??0});this.save.emit(e),this.courseForm.reset()}}onReset(){this.courseForm.reset()}static \u0275fac=function(e){return new(e||r)(N(L))};static \u0275cmp=b({type:r,selectors:[["app-course-form"]],inputs:{course:"course"},outputs:{save:"save"},features:[P],decls:18,vars:7,consts:[[3,"ngSubmit","formGroup"],["type","hidden","formControlName","id"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","title",1,"form-control"],[1,"invalid-feedback"],["rows","3","formControlName","description",1,"form-control"],["type","submit",1,"btn","btn-success","me-2"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(e,o){if(e&1&&(n(0,"form",0),u("ngSubmit",function(){return o.onSubmit()}),C(1,"input",1),n(2,"div",2)(3,"label",3),s(4,"T\xEDtulo"),i(),C(5,"input",4),n(6,"div",5),s(7),i()(),n(8,"div",2)(9,"label",3),s(10,"Descripci\xF3n"),i(),C(11,"textarea",6),n(12,"div",5),s(13),i()(),n(14,"button",7),s(15,"Guardar"),i(),n(16,"button",8),u("click",function(){return o.onReset()}),s(17,"Cancelar"),i()()),e&2){let l,m;c("formGroup",o.courseForm),a(5),D("is-invalid",((l=o.courseForm.get("title"))==null?null:l.invalid)&&((l=o.courseForm.get("title"))==null?null:l.touched)),a(2),f(o.getErrorMessage("title")),a(4),D("is-invalid",((m=o.courseForm.get("description"))==null?null:m.invalid)&&((m=o.courseForm.get("description"))==null?null:m.touched)),a(2),f(o.getErrorMessage("description"))}},dependencies:[h,U,q,H,$,j,B,z],styles:["[_nghost-%COMP%]{display:block;padding:1rem}"]})};function _e(r,t){if(r&1){let e=y();n(0,"button",8),u("click",function(){_(e);let l=p();return g(l.newCourse())}),s(1," A\xF1adir curso "),i()}}function ge(r,t){r&1&&(n(0,"div",9),s(1,"Cargando..."),i())}function be(r,t){if(r&1&&(n(0,"div",10),s(1),i()),r&2){let e=p();a(),f(e.errorMsg)}}function he(r,t){if(r&1){let e=y();n(0,"div",11)(1,"div",12)(2,"h5",13),s(3),i(),n(4,"app-course-form",14),u("save",function(l){_(e);let m=p();return g(m.saveCourse(l))}),i()()()}if(r&2){let e=p();a(3),A(" ",e.courseToEdit.id===0?"A\xF1adir curso":"Editar curso"," "),a(),c("course",e.courseToEdit)}}var ae=class r{svc=T(ie);cdr=T(V);auth=T(G);get isAdmin(){return this.auth.hasRole("admin")}courses=[];courseToEdit=null;loading=!1;errorMsg=null;async ngOnInit(){await this.load()}async load(){this.loading=!0,this.errorMsg=null;try{this.courses=await v(this.svc.getCourses())}catch(t){this.errorMsg=t?.message??"No se pudieron cargar los cursos"}finally{this.loading=!1,this.cdr.detectChanges()}}newCourse(){this.isAdmin&&(this.courseToEdit={id:0,title:"",description:""},this.cdr.detectChanges())}editCourse(t){this.isAdmin&&(this.courseToEdit=E({},t),this.cdr.detectChanges())}async saveCourse(t){if(this.isAdmin)try{if(!t.id||t.id===0){let e=t,{id:o}=e,l=O(e,["id"]);await v(this.svc.addCourse(l))}else await v(this.svc.updateCourse(t));await this.load(),this.courseToEdit=null}catch(o){this.errorMsg=o?.message??"No se pudo guardar el curso"}}async deleteCourse(t){if(this.isAdmin)try{await v(this.svc.deleteCourse(t.id)),await this.load()}catch(e){this.errorMsg=e?.message??"No se pudo eliminar el curso"}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=b({type:r,selectors:[["app-courses"]],decls:9,vars:6,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[3,"editar","eliminar","courses","canEdit"],["class","card mt-4",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"card","mt-4"],[1,"card-body"],[1,"card-title"],[3,"save","course"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"h4",2),s(3,"Listado de cursos"),i(),d(4,_e,2,0,"button",3),i(),d(5,ge,2,0,"div",4)(6,be,2,1,"div",5),n(7,"app-courses-table",6),u("editar",function(m){return o.editCourse(m)})("eliminar",function(m){return o.deleteCourse(m)}),i(),d(8,he,5,2,"div",7),i()),e&2&&(a(4),c("ngIf",o.isAdmin),a(),c("ngIf",o.loading),a(),c("ngIf",o.errorMsg),a(),c("courses",o.courses)("canEdit",o.isAdmin),a(),c("ngIf",o.isAdmin&&o.courseToEdit))},dependencies:[h,R,S,F],encapsulation:2})};export{ae as CoursesComponent};
