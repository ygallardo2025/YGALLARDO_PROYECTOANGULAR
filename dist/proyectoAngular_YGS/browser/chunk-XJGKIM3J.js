import{a as ue}from"./chunk-ZQGHR2R6.js";import{a as ee,b as te,c as ne,d as ie,e as re,f as oe,g as ae,h as de,i as me,j as se,k as le}from"./chunk-V6KXUH27.js";import{a as L}from"./chunk-G2WS7ZM2.js";import{a as U,b as h,c as z,d as J,e as K,f as Q,g as W,h as X,l as Y,m as Z}from"./chunk-CF6JDDZ2.js";import{g as I,h as q,i as x}from"./chunk-S7ZWUZXC.js";import{$a as c,Ca as E,Ga as v,Ja as j,L as G,La as u,Na as y,O as H,Ya as m,Za as r,_a as i,a as w,b as k,ba as _,ca as C,db as b,eb as g,gb as T,hb as f,ib as s,j as $,ma as B,q as M,qb as o,r as A,s as R,sb as S,wb as D,xa as d,xb as F}from"./chunk-6F7WF5WO.js";var P=class n{transform(e){if(!e)return"";let t=e.name??"",a=e.surname??"";return`${t} ${a}`.trim()}static \u0275fac=function(t){return new(t||n)};static \u0275pipe=j({name:"fullname",type:n,pure:!0})};function _e(n,e){n&1&&(r(0,"th",10),o(1,"Nombre"),i())}function Ce(n,e){if(n&1&&(r(0,"td",11),o(1),D(2,"fullname"),i()),n&2){let t=e.$implicit;d(),S(" ",F(2,1,t)," ")}}function be(n,e){n&1&&(r(0,"th",10),o(1,"Edad"),i())}function ge(n,e){if(n&1&&(r(0,"td",11),o(1),i()),n&2){let t=e.$implicit;d(),S(" ",t.age," ")}}function Se(n,e){n&1&&(r(0,"th",10),o(1,"DNI"),i())}function ve(n,e){if(n&1&&(r(0,"td",11),o(1),i()),n&2){let t=e.$implicit;d(),S(" ",t.dni," ")}}function xe(n,e){n&1&&(r(0,"th",10),o(1,"Promedio"),i())}function he(n,e){if(n&1&&(r(0,"td",11),o(1),i()),n&2){let t=e.$implicit;d(),S(" ",t.average," ")}}function Ee(n,e){n&1&&(r(0,"th",10),o(1,"Acciones"),i())}function ye(n,e){if(n&1){let t=T();b(0),r(1,"button",13),f("click",function(){_(t);let l=s().$implicit,p=s();return C(p.editarEstudiante(l))}),o(2,"Editar"),i(),r(3,"button",14),f("click",function(){_(t);let l=s().$implicit,p=s();return C(p.eliminarEstudiante(l))}),o(4,"Eliminar"),i(),g()}}function Te(n,e){n&1&&(b(0),o(1,"\u2014"),g())}function we(n,e){if(n&1&&(r(0,"td",11),u(1,ye,5,0,"ng-container",12)(2,Te,2,0,"ng-container",12),i()),n&2){let t=s();d(),m("ngIf",t.canEdit),d(),m("ngIf",!t.canEdit)}}function Me(n,e){n&1&&c(0,"tr",15)}function De(n,e){n&1&&c(0,"tr",16)}var N=class n{students=[];canEdit=!1;eliminar=new y;editar=new y;displayedColumns=["fullname","age","dni","average","actions"];eliminarEstudiante(e){this.eliminar.emit(e)}editarEstudiante(e){this.editar.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=v({type:n,selectors:[["app-students-table"]],inputs:{students:"students",canEdit:"canEdit"},outputs:{eliminar:"eliminar",editar:"editar"},decls:18,vars:3,consts:[["mat-table","",1,"mat-elevation-z1",3,"dataSource"],["matColumnDef","fullname"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-cell","","class","text-center",4,"matCellDef"],["matColumnDef","age"],["matColumnDef","dni"],["matColumnDef","average"],["matColumnDef","actions"],["mat-header-row","","class","table-primary",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"text-center"],["mat-cell","",1,"text-center"],[4,"ngIf"],[1,"btn","btn-sm","btn-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"],["mat-header-row","",1,"table-primary"],["mat-row",""]],template:function(t,a){t&1&&(r(0,"table",0),b(1,1),u(2,_e,2,0,"th",2)(3,Ce,3,3,"td",3),g(),b(4,4),u(5,be,2,0,"th",2)(6,ge,2,1,"td",3),g(),b(7,5),u(8,Se,2,0,"th",2)(9,ve,2,1,"td",3),g(),b(10,6),u(11,xe,2,0,"th",2)(12,he,2,1,"td",3),g(),b(13,7),u(14,Ee,2,0,"th",2)(15,we,3,2,"td",3),g(),u(16,Me,1,0,"tr",8)(17,De,1,0,"tr",9),i()),t&2&&(m("dataSource",a.students),d(16),m("matHeaderRowDef",a.displayedColumns),d(),m("matRowDefColumns",a.displayedColumns))},dependencies:[x,I,le,ee,ne,ae,ie,te,de,re,oe,me,se,P],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0;border-radius:12px;overflow:hidden;background-color:#fff;box-shadow:0 2px 6px #0000000d;font-family:Segoe UI,sans-serif;border:1px solid #eee}th[_ngcontent-%COMP%]{background-color:#f7f7f7;color:#333;font-weight:600;padding:14px;text-align:center;border-bottom:1px solid #e0e0e0}td[_ngcontent-%COMP%]{padding:14px;text-align:center;border-bottom:1px solid #f0f0f0}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}tr[_ngcontent-%COMP%]:hover{background-color:#f9f9f9;transition:background-color .2s ease}button[_ngcontent-%COMP%]{border:none;border-radius:6px;padding:6px 14px;font-weight:500}.btn-primary[_ngcontent-%COMP%]{background-color:#2979ff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#1565c0}.btn-danger[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c62828}"],changeDetection:0})};var O=class n{constructor(e){this.fb=e;this.studentForm=this.fb.group({id:[null],name:["",h.required],surname:["",h.required],age:[null,h.required],dni:["",h.required],average:[null,h.required]})}student=null;save=new y;studentForm;ngOnChanges(e){e.student&&this.student&&this.studentForm.reset(this.student)}guardarCambios(){if(this.studentForm.markAllAsTouched(),this.studentForm.valid){let e=this.studentForm.value,t=k(w({},e),{id:this.student?.id??e.id??0});this.save.emit(t),this.studentForm.reset()}}static \u0275fac=function(t){return new(t||n)(E(Y))};static \u0275cmp=v({type:n,selectors:[["app-student-form"]],inputs:{student:"student"},outputs:{save:"save"},features:[B],decls:24,vars:1,consts:[[3,"ngSubmit","formGroup"],["type","hidden","formControlName","id"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","formControlName","name",1,"form-control"],["for","surname",1,"form-label"],["type","text","id","surname","formControlName","surname",1,"form-control"],["for","dni",1,"form-label"],["type","text","id","dni","formControlName","dni",1,"form-control"],["for","age",1,"form-label"],["type","number","id","age","formControlName","age",1,"form-control"],["for","average",1,"form-label"],["type","number","id","average","formControlName","average",1,"form-control"],["type","submit",1,"btn","btn-success","mt-2"]],template:function(t,a){t&1&&(r(0,"form",0),f("ngSubmit",function(){return a.guardarCambios()}),c(1,"input",1),r(2,"div",2)(3,"label",3),o(4,"Nombre"),i(),c(5,"input",4),i(),r(6,"div",2)(7,"label",5),o(8,"Apellido"),i(),c(9,"input",6),i(),r(10,"div",2)(11,"label",7),o(12,"DNI"),i(),c(13,"input",8),i(),r(14,"div",2)(15,"label",9),o(16,"Edad"),i(),c(17,"input",10),i(),r(18,"div",2)(19,"label",11),o(20,"Promedio"),i(),c(21,"input",12),i(),r(22,"button",13),o(23,"Guardar"),i()()),t&2&&m("formGroup",a.studentForm)},dependencies:[x,Z,K,U,Q,z,J,W,X],styles:["form[_ngcontent-%COMP%]{max-width:600px}input.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};function Fe(n,e){if(n&1){let t=T();r(0,"div",7)(1,"div",8)(2,"h5",9),o(3),i(),r(4,"app-student-form",10),f("save",function(l){_(t);let p=s(2);return C(p.onGuardarEditado(l))}),i()()()}if(n&2){let t=s(2);d(3),S(" ",t.estudianteEditando.id===0?"A\xF1adir estudiante":"Editar estudiante"," "),d(),m("student",t.estudianteEditando)}}function Ie(n,e){if(n&1){let t=T();r(0,"div",1)(1,"div",2)(2,"h4",3),o(3,"Listado de estudiantes"),i(),r(4,"button",4),f("click",function(){_(t);let l=s();return C(l.nuevoEstudiante())}),o(5," A\xF1adir estudiante "),i()(),r(6,"app-students-table",5),f("editar",function(l){_(t);let p=s();return C(p.onEditar(l))})("eliminar",function(l){_(t);let p=s();return C(p.onEliminar(l))}),i(),u(7,Fe,5,2,"div",6),i()}if(n&2){let t=e.ngIf,a=s();d(4),m("disabled",!t.canEdit),d(2),m("students",t.students)("canEdit",t.canEdit),d(),m("ngIf",a.estudianteEditando)}}var pe=class n{constructor(e,t){this.studentsService=e;this.auth=t}refresh$=new $(void 0);vm$;estudianteEditando=null;ngOnInit(){this.vm$=R([this.refresh$.pipe(H(()=>this.studentsService.getStudents())),this.auth.currentUser$]).pipe(A(([e,t])=>({students:e,canEdit:!!t&&t.role==="admin"})),G(1))}nuevoEstudiante(){this.estudianteEditando={id:0,name:"",surname:"",dni:"",age:0,average:0}}onEditar(e){this.estudianteEditando=w({},e)}async onGuardarEditado(e){e.id===0?await M(this.studentsService.addStudent(e)):await M(this.studentsService.updateStudent(e)),this.estudianteEditando=null,this.refresh$.next()}async onEliminar(e){await M(this.studentsService.deleteStudent(e.id)),this.refresh$.next()}static \u0275fac=function(t){return new(t||n)(E(ue),E(L))};static \u0275cmp=v({type:n,selectors:[["app-students-manager"]],decls:2,vars:3,consts:[["class","container mt-4",4,"ngIf"],[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],[1,"btn","btn-primary",3,"click","disabled"],[3,"editar","eliminar","students","canEdit"],["class","card mt-4",4,"ngIf"],[1,"card","mt-4"],[1,"card-body"],[1,"card-title"],[3,"save","student"]],template:function(t,a){t&1&&(u(0,Ie,8,4,"div",0),D(1,"async")),t&2&&m("ngIf",F(1,1,a.vm$))},dependencies:[x,I,N,O,q],encapsulation:2,changeDetection:0})};export{pe as StudentsManagerComponent};
