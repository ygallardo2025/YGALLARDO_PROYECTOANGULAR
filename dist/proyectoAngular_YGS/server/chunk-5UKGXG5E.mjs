import './polyfills.server.mjs';
import{a as dt}from"./chunk-5J4RD3KS.mjs";import{a as W,b as X,c as Y,d as Z,e as tt,f as et,g as nt,h as it,i as at,j as rt,k as ot}from"./chunk-6MB6744H.mjs";import{a as H}from"./chunk-WK4RUDQ5.mjs";import{a as j,b as x,c as q,d as B,e as z,f as L,g as U,h as J,l as K,m as Q}from"./chunk-WIJPIGRI.mjs";import{i as $,j as v}from"./chunk-GOQIUZKS.mjs";import{$a as u,Ba as y,Fa as g,Ia as A,Ka as l,Kb as G,Ma as T,T as O,Y as b,Ya as s,Z as _,Za as a,_a as i,db as S,eb as h,gb as M,hb as p,ia as k,ib as f,n as E,qb as r,sb as C,wa as d,wb as V,xb as R}from"./chunk-TQ27SS2T.mjs";import{a as w,b as P}from"./chunk-T55IDOPT.mjs";var D=class e{transform(t){return`${t.name} ${t.surname}`}static \u0275fac=function(n){return new(n||e)};static \u0275pipe=A({name:"fullname",type:e,pure:!0})};function lt(e,t){e&1&&(a(0,"th",10),r(1,"Nombre"),i())}function ut(e,t){if(e&1&&(a(0,"td",11),r(1),V(2,"fullname"),i()),e&2){let n=t.$implicit;d(),C(" ",R(2,1,n)," ")}}function ct(e,t){e&1&&(a(0,"th",10),r(1,"Edad"),i())}function pt(e,t){if(e&1&&(a(0,"td",11),r(1),i()),e&2){let n=t.$implicit;d(),C(" ",n.age," ")}}function ft(e,t){e&1&&(a(0,"th",10),r(1,"DNI"),i())}function Ct(e,t){if(e&1&&(a(0,"td",11),r(1),i()),e&2){let n=t.$implicit;d(),C(" ",n.dni," ")}}function bt(e,t){e&1&&(a(0,"th",10),r(1,"Promedio"),i())}function _t(e,t){if(e&1&&(a(0,"td",11),r(1),i()),e&2){let n=t.$implicit;d(),C(" ",n.average," ")}}function gt(e,t){e&1&&(a(0,"th",10),r(1,"Acciones"),i())}function St(e,t){if(e&1){let n=M();a(0,"td",11)(1,"button",12),p("click",function(){let m=b(n).$implicit,c=f();return _(c.editarEstudiante(m))}),r(2,"Editar"),i(),a(3,"button",13),p("click",function(){let m=b(n).$implicit,c=f();return _(c.eliminarEstudiante(m))}),r(4,"Eliminar"),i()()}}function ht(e,t){e&1&&u(0,"tr",14)}function vt(e,t){e&1&&u(0,"tr",15)}var F=class e{students=[];canEdit=!1;eliminar=new T;editar=new T;baseColumns=["fullname","age","dni","average"];get displayedColumns(){return this.canEdit?[...this.baseColumns,"actions"]:this.baseColumns}eliminarEstudiante(t){this.eliminar.emit(t)}editarEstudiante(t){this.editar.emit(t)}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=g({type:e,selectors:[["app-students-table"]],inputs:{students:"students",canEdit:"canEdit"},outputs:{eliminar:"eliminar",editar:"editar"},decls:18,vars:3,consts:[["mat-table","",1,"mat-elevation-z1",3,"dataSource"],["matColumnDef","fullname"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-cell","","class","text-center",4,"matCellDef"],["matColumnDef","age"],["matColumnDef","dni"],["matColumnDef","average"],["matColumnDef","actions"],["mat-header-row","","class","table-primary",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"text-center"],["mat-cell","",1,"text-center"],[1,"btn","btn-sm","btn-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"],["mat-header-row","",1,"table-primary"],["mat-row",""]],template:function(n,o){n&1&&(a(0,"table",0),S(1,1),l(2,lt,2,0,"th",2)(3,ut,3,3,"td",3),h(),S(4,4),l(5,ct,2,0,"th",2)(6,pt,2,1,"td",3),h(),S(7,5),l(8,ft,2,0,"th",2)(9,Ct,2,1,"td",3),h(),S(10,6),l(11,bt,2,0,"th",2)(12,_t,2,1,"td",3),h(),S(13,7),l(14,gt,2,0,"th",2)(15,St,5,0,"td",3),h(),l(16,ht,1,0,"tr",8)(17,vt,1,0,"tr",9),i()),n&2&&(s("dataSource",o.students),d(16),s("matHeaderRowDef",o.displayedColumns),d(),s("matRowDefColumns",o.displayedColumns))},dependencies:[v,ot,W,Y,nt,Z,X,it,tt,et,at,rt,D],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0;border-radius:12px;overflow:hidden;background-color:#fff;box-shadow:0 2px 6px #0000000d;font-family:Segoe UI,sans-serif;border:1px solid #eee}th[_ngcontent-%COMP%]{background-color:#f7f7f7;color:#333;font-weight:600;padding:14px;text-align:center;border-bottom:1px solid #e0e0e0}td[_ngcontent-%COMP%]{padding:14px;text-align:center;border-bottom:1px solid #f0f0f0}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}tr[_ngcontent-%COMP%]:hover{background-color:#f9f9f9;transition:background-color .2s ease}button[_ngcontent-%COMP%]{border:none;border-radius:6px;padding:6px 14px;font-weight:500}.btn-primary[_ngcontent-%COMP%]{background-color:#2979ff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#1565c0}.btn-danger[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c62828}"]})};var I=class e{constructor(t){this.fb=t;this.studentForm=this.fb.group({id:[null],name:["",x.required],surname:["",x.required],age:[null,x.required],dni:["",x.required],average:[null,x.required]})}student=null;save=new T;studentForm;ngOnChanges(t){t.student&&this.student&&this.studentForm.reset(this.student)}guardarCambios(){if(this.studentForm.markAllAsTouched(),this.studentForm.valid){let t=this.studentForm.value,n=P(w({},t),{id:this.student?.id??t.id??0});this.save.emit(n),this.studentForm.reset()}}static \u0275fac=function(n){return new(n||e)(y(K))};static \u0275cmp=g({type:e,selectors:[["app-student-form"]],inputs:{student:"student"},outputs:{save:"save"},features:[k],decls:24,vars:1,consts:[[3,"ngSubmit","formGroup"],["type","hidden","formControlName","id"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","formControlName","name",1,"form-control"],["for","surname",1,"form-label"],["type","text","id","surname","formControlName","surname",1,"form-control"],["for","dni",1,"form-label"],["type","text","id","dni","formControlName","dni",1,"form-control"],["for","age",1,"form-label"],["type","number","id","age","formControlName","age",1,"form-control"],["for","average",1,"form-label"],["type","number","id","average","formControlName","average",1,"form-control"],["type","submit",1,"btn","btn-success","mt-2"]],template:function(n,o){n&1&&(a(0,"form",0),p("ngSubmit",function(){return o.guardarCambios()}),u(1,"input",1),a(2,"div",2)(3,"label",3),r(4,"Nombre"),i(),u(5,"input",4),i(),a(6,"div",2)(7,"label",5),r(8,"Apellido"),i(),u(9,"input",6),i(),a(10,"div",2)(11,"label",7),r(12,"DNI"),i(),u(13,"input",8),i(),a(14,"div",2)(15,"label",9),r(16,"Edad"),i(),u(17,"input",10),i(),a(18,"div",2)(19,"label",11),r(20,"Promedio"),i(),u(21,"input",12),i(),a(22,"button",13),r(23,"Guardar"),i()()),n&2&&s("formGroup",o.studentForm)},dependencies:[v,Q,z,j,L,q,B,U,J],styles:["form[_ngcontent-%COMP%]{max-width:600px}input.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};function xt(e,t){if(e&1){let n=M();a(0,"button",6),p("click",function(){b(n);let m=f();return _(m.nuevoEstudiante())}),r(1,"A\xF1adir estudiante"),i()}}function Et(e,t){if(e&1){let n=M();a(0,"div",7)(1,"div",8)(2,"h5",9),r(3),i(),a(4,"app-student-form",10),p("save",function(m){b(n);let c=f();return _(c.onGuardarEditado(m))}),i()()()}if(e&2){let n=f();d(3),C(" ",n.estudianteEditando.id===0?"A\xF1adir estudiante":"Editar estudiante"," "),d(),s("student",n.estudianteEditando)}}var mt=class e{constructor(t,n){this.studentsService=t;this.cdr=n}auth=O(H);students=[];estudianteEditando=null;get isAdmin(){return this.auth.hasRole("admin")}async ngOnInit(){await this.cargar()}async cargar(){this.students=await E(this.studentsService.getStudents()),this.cdr.detectChanges()}nuevoEstudiante(){this.isAdmin&&(this.estudianteEditando={id:0,name:"",surname:"",dni:"",age:0,average:0},this.cdr.detectChanges())}onEditar(t){this.isAdmin&&(this.estudianteEditando=w({},t),this.cdr.detectChanges())}async onGuardarEditado(t){if(this.isAdmin){if(t.id===0){let n=await E(this.studentsService.addStudent(t));this.students=[...this.students,n]}else{let n=await E(this.studentsService.updateStudent(t));this.students=this.students.map(o=>o.id===n.id?n:o)}this.estudianteEditando=null,this.cdr.detectChanges()}}async onEliminar(t){this.isAdmin&&(await E(this.studentsService.deleteStudent(t.id)),this.students=this.students.filter(n=>n.id!==t.id),this.cdr.detectChanges())}static \u0275fac=function(n){return new(n||e)(y(dt),y(G))};static \u0275cmp=g({type:e,selectors:[["app-students-manager"]],decls:7,vars:4,consts:[[1,"container","mt-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],["class","btn btn-primary",3,"click",4,"ngIf"],[3,"editar","eliminar","students","canEdit"],["class","card mt-4",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"card","mt-4"],[1,"card-body"],[1,"card-title"],[3,"save","student"]],template:function(n,o){n&1&&(a(0,"div",0)(1,"div",1)(2,"h4",2),r(3,"Listado de estudiantes"),i(),l(4,xt,2,0,"button",3),i(),a(5,"app-students-table",4),p("editar",function(c){return o.onEditar(c)})("eliminar",function(c){return o.onEliminar(c)}),i(),l(6,Et,5,2,"div",5),i()),n&2&&(d(4),s("ngIf",o.isAdmin),d(),s("students",o.students)("canEdit",o.isAdmin),d(),s("ngIf",o.isAdmin&&o.estudianteEditando))},dependencies:[v,$,F,I],encapsulation:2})};export{mt as StudentsManagerComponent};
