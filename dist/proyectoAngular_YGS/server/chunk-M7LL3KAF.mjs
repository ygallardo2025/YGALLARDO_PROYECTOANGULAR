import './polyfills.server.mjs';
import{a as fe}from"./chunk-5J4RD3KS.mjs";import{a as Ee}from"./chunk-HO3CVD5F.mjs";import{a as ie,b as re,c as oe,d as le,e as ae,f as me,g as se,h as de,i as ce,j as pe,k as ue}from"./chunk-6MB6744H.mjs";import{a as z}from"./chunk-WK4RUDQ5.mjs";import{a as J,b as V,c as K,d as L,e as Q,g as W,h as X,i as Y,j as Z,k as ee,l as te,m as ne}from"./chunk-WIJPIGRI.mjs";import{h as q,i as D,j as h,r as B}from"./chunk-GOQIUZKS.mjs";import{$a as x,Ba as g,Fa as v,Ka as c,Kb as U,Ma as S,O as R,S as j,T as H,Y as C,Ya as m,Z as _,Za as o,_a as r,db as w,eb as M,gb as I,hb as p,ia as $,ib as b,n as E,o as y,qb as l,rb as T,sb as G,tb as O,wa as a}from"./chunk-TQ27SS2T.mjs";import{a as u,b as f,d as P}from"./chunk-T55IDOPT.mjs";function Ce(n,e){n&1&&(o(0,"th",8),l(1,"Alumno"),r())}function _e(n,e){if(n&1&&(o(0,"td",9),l(1),r()),n&2){let t=e.$implicit;a(),O(" ",t.student==null?null:t.student.name," ",t.student==null?null:t.student.surname," ")}}function ve(n,e){n&1&&(o(0,"th",8),l(1,"Curso"),r())}function he(n,e){if(n&1&&(o(0,"td",9),l(1),r()),n&2){let t=e.$implicit;a(),G(" ",t.course==null?null:t.course.title," ")}}function Se(n,e){n&1&&(o(0,"th",8),l(1,"Acciones"),r())}function xe(n,e){if(n&1){let t=I();o(0,"td",9)(1,"button",10),p("click",function(){let s=C(t).$implicit,d=b();return _(d.onEdit(s))}),l(2,"Editar"),r(),o(3,"button",11),p("click",function(){let s=C(t).$implicit,d=b();return _(d.onDelete(s))}),l(4,"Eliminar"),r()()}}function Ie(n,e){n&1&&x(0,"tr",12)}function ye(n,e){n&1&&x(0,"tr",13)}var F=class n{enrollments=[];canEdit=!1;editar=new S;eliminar=new S;baseColumns=["student","course"];get displayedColumns(){return this.canEdit?[...this.baseColumns,"actions"]:this.baseColumns}onEdit(e){this.editar.emit(e)}onDelete(e){this.eliminar.emit(e)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=v({type:n,selectors:[["app-enrollment-table"]],inputs:{enrollments:"enrollments",canEdit:"canEdit"},outputs:{editar:"editar",eliminar:"eliminar"},decls:12,vars:3,consts:[["mat-table","",1,"mat-elevation-z1",3,"dataSource"],["matColumnDef","student"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-cell","","class","text-center",4,"matCellDef"],["matColumnDef","course"],["matColumnDef","actions"],["mat-header-row","","class","table-primary",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"text-center"],["mat-cell","",1,"text-center"],[1,"btn","btn-sm","btn-primary","me-2",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"],["mat-header-row","",1,"table-primary"],["mat-row",""]],template:function(t,i){t&1&&(o(0,"table",0),w(1,1),c(2,Ce,2,0,"th",2)(3,_e,2,2,"td",3),M(),w(4,4),c(5,ve,2,0,"th",2)(6,he,2,1,"td",3),M(),w(7,5),c(8,Se,2,0,"th",2)(9,xe,5,0,"td",3),M(),c(10,Ie,1,0,"tr",6)(11,ye,1,0,"tr",7),r()),t&2&&(m("dataSource",i.enrollments),a(10),m("matHeaderRowDef",i.displayedColumns),a(),m("matRowDefColumns",i.displayedColumns))},dependencies:[h,ue,ie,oe,se,le,re,de,ae,me,ce,pe],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0;border-radius:12px;overflow:hidden;background-color:#fff;box-shadow:0 2px 6px #0000000d;font-family:Segoe UI,sans-serif;border:1px solid #eee}th[_ngcontent-%COMP%]{background-color:#f7f7f7;color:#333;font-weight:600;padding:14px;text-align:center;border-bottom:1px solid #e0e0e0}td[_ngcontent-%COMP%]{padding:14px;text-align:center;border-bottom:1px solid #f0f0f0}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}tr[_ngcontent-%COMP%]:hover{background-color:#f9f9f9;transition:background-color .2s ease}button[_ngcontent-%COMP%]{border:none;border-radius:6px;padding:6px 14px;font-weight:500}.btn-primary[_ngcontent-%COMP%]{background-color:#2979ff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#1565c0}.btn-danger[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c62828}"]})};function Me(n,e){if(n&1&&(o(0,"option",10),l(1),r()),n&2){let t=e.$implicit;m("ngValue",t.id),a(),O("",t.name," ",t.surname)}}function Te(n,e){n&1&&(o(0,"div",11),l(1," Debe seleccionar un alumno. "),r())}function Oe(n,e){if(n&1&&(o(0,"option",10),l(1),r()),n&2){let t=e.$implicit;m("ngValue",t.id),a(),T(t.title)}}function De(n,e){n&1&&(o(0,"div",11),l(1," Debe seleccionar un curso. "),r())}var A=class n{constructor(e){this.fb=e;this.form=this.fb.group({id:[null],studentId:[null,[V.required]],courseId:[null,[V.required]]})}enrollment=null;students=[];courses=[];save=new S;form;ngOnChanges(e){e.enrollment&&this.enrollment&&this.form.reset(this.enrollment)}onSubmit(){if(this.form.markAllAsTouched(),!this.form.valid)return;let e=this.form.value,t=f(u({},e),{id:this.enrollment?.id??e.id??0});this.save.emit(t),this.form.reset()}static \u0275fac=function(t){return new(t||n)(g(te))};static \u0275cmp=v({type:n,selectors:[["app-enrollment-form"]],inputs:{enrollment:"enrollment",students:"students",courses:"courses"},outputs:{save:"save"},features:[$],decls:20,vars:8,consts:[[3,"ngSubmit","formGroup"],["type","hidden","formControlName","id"],[1,"mb-3"],[1,"form-label"],["formControlName","studentId",1,"form-select"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["class","text-danger small mt-1",4,"ngIf"],["formControlName","courseId",1,"form-select"],["type","submit",1,"btn","btn-success",3,"disabled"],[3,"ngValue"],[1,"text-danger","small","mt-1"]],template:function(t,i){if(t&1&&(o(0,"form",0),p("ngSubmit",function(){return i.onSubmit()}),x(1,"input",1),o(2,"div",2)(3,"label",3),l(4,"Alumno"),r(),o(5,"select",4)(6,"option",5),l(7,"Seleccione un alumno..."),r(),c(8,Me,2,3,"option",6),r(),c(9,Te,2,0,"div",7),r(),o(10,"div",2)(11,"label",3),l(12,"Curso"),r(),o(13,"select",8)(14,"option",5),l(15,"Seleccione un curso..."),r(),c(16,Oe,2,2,"option",6),r(),c(17,De,2,0,"div",7),r(),o(18,"button",9),l(19,"Guardar"),r()()),t&2){let s,d;m("formGroup",i.form),a(6),m("ngValue",null),a(2),m("ngForOf",i.students),a(),m("ngIf",((s=i.form.get("studentId"))==null?null:s.touched)&&((s=i.form.get("studentId"))==null?null:s.hasError("required"))),a(5),m("ngValue",null),a(2),m("ngForOf",i.courses),a(),m("ngIf",((d=i.form.get("courseId"))==null?null:d.touched)&&((d=i.form.get("courseId"))==null?null:d.hasError("required"))),a(),m("disabled",i.form.invalid)}},dependencies:[h,q,D,ne,Q,Z,ee,J,Y,K,L,W,X],encapsulation:2})};var N=class n{constructor(e){this.http=e}apiUrl="https://68a470c4c123272fb9b2b56f.mockapi.io/enrollment";fromApi=e=>f(u({},e),{id:Number(e.id),studentId:Number(e.studentId),courseId:Number(e.courseId)});toApi=e=>f(u({},e),{id:String(e.id),studentId:String(e.studentId),courseId:String(e.courseId)});getAll(){return this.http.get(this.apiUrl).pipe(y(e=>e.map(this.fromApi)))}add(e){let t={studentId:String(e.studentId),courseId:String(e.courseId)};return this.http.post(this.apiUrl,t).pipe(y(this.fromApi))}update(e){return this.http.put(`${this.apiUrl}/${e.id}`,this.toApi(e)).pipe(y(this.fromApi))}delete(e){return this.http.delete(`${this.apiUrl}/${e}`)}static \u0275fac=function(t){return new(t||n)(j(B))};static \u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"})};function Ae(n,e){if(n&1){let t=I();o(0,"button",5),p("click",function(){C(t);let s=b();return _(s.newEnrollment())}),l(1,"Nueva inscripci\xF3n"),r()}}function Ne(n,e){if(n&1){let t=I();o(0,"div",6)(1,"div",7)(2,"h5",8),l(3),r(),o(4,"app-enrollment-form",9),p("save",function(s){C(t);let d=b();return _(d.saveEnrollment(s))}),r()()()}if(n&2){let t=b();a(3),T(t.editing.id===0?"Nueva inscripci\xF3n":"Editar inscripci\xF3n"),a(),m("enrollment",t.editing)("students",t.students)("courses",t.courses)}}var be=class n{constructor(e,t,i,s){this.enrollmentService=e;this.studentsService=t;this.coursesService=i;this.cdr=s}auth=H(z);get isAdmin(){return this.auth.hasRole("admin")}enrollments=[];students=[];courses=[];editing=null;async ngOnInit(){await this.loadInitial()}async loadInitial(){try{let[e,t]=await Promise.all([E(this.studentsService.getStudents()),E(this.coursesService.getCourses())]);this.students=e,this.courses=t,await this.reload()}finally{this.cdr.detectChanges()}}async reload(){let e=await E(this.enrollmentService.getAll());this.enrollments=this.decorate(e),this.cdr.detectChanges()}decorate(e){return e.map(t=>f(u({},t),{student:this.students.find(i=>i.id===t.studentId),course:this.courses.find(i=>i.id===t.courseId)}))}newEnrollment(){this.editing={id:0,studentId:null,courseId:null},this.cdr.detectChanges()}editEnrollment(e){this.editing={id:e.id,studentId:e.studentId,courseId:e.courseId},this.cdr.detectChanges()}async saveEnrollment(e){try{if(e.id&&e.id!==0)await E(this.enrollmentService.update(e));else{let t=e,{id:i}=t,s=P(t,["id"]);await E(this.enrollmentService.add(s))}await this.reload()}finally{this.editing=null,this.cdr.detectChanges()}}async deleteEnrollment(e){await E(this.enrollmentService.delete(e.id)),await this.reload()}static \u0275fac=function(t){return new(t||n)(g(N),g(fe),g(Ee),g(U))};static \u0275cmp=v({type:n,selectors:[["app-enrollments-manager"]],decls:6,vars:4,consts:[[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"mb-0"],["class","btn btn-primary",3,"click",4,"ngIf"],[3,"editar","eliminar","enrollments","canEdit"],["class","card mt-4",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"card","mt-4"],[1,"card-body"],[1,"card-title"],[3,"save","enrollment","students","courses"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"h4",1),l(2,"Inscripciones"),r(),c(3,Ae,2,0,"button",2),r(),o(4,"app-enrollment-table",3),p("editar",function(d){return i.editEnrollment(d)})("eliminar",function(d){return i.deleteEnrollment(d)}),r(),c(5,Ne,5,4,"div",4)),t&2&&(a(3),m("ngIf",i.isAdmin),a(),m("enrollments",i.enrollments)("canEdit",i.isAdmin),a(),m("ngIf",i.isAdmin&&i.editing))},dependencies:[h,D,F,A],encapsulation:2})};export{be as EnrollmentsManagerComponent};
